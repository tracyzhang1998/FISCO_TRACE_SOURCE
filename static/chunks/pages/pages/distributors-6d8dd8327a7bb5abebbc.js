(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[535],{6393:function(e,n,s){"use strict";s.r(n);var r=s(6311),t=s(266),l=s(809),a=s.n(l),c=s(7294),i=s(3651),d=s(4372),o=s(8196),u=s(1721),x=s(5893);n.default=function(){var e=(0,c.useState)([]),n=e[0],s=e[1],l=(0,c.useState)(""),h=l[0],p=l[1],m=(0,c.useState)({productInfo:{productName:"",producerName:"",productionDate:"",location:"",batchNumber:"",ingredients:[]},productHash:"",owner:"",paused:!1,chainTraces:[]}),j=m[0],f=m[1],b=(0,c.useState)([]),T=b[0],g=b[1],C=(0,c.useState)(!1),w=C[0],N=C[1],v=(0,c.useState)(!1),I=v[0],k=v[1],S=(0,c.useState)(!1),y=S[0],D=S[1];function M(e,n){"0"!==localStorage.getItem("isRegister")?1===e?(f(n),N(!0)):2===e?(f(n),k(!0)):3===e&&(f(n),D(!0)):alert("\u672a\u5ba1\u6838\u901a\u8fc7\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff01")}function R(e){1===e?N(!1):2===e?k(!1):3===e&&D(!1)}function H(){return _.apply(this,arguments)}function _(){return(_=(0,t.Z)(a().mark((function e(){var n,t,l,c,i,d,o,x,h,p,m,j,f,b,T,C,w;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.Dg)();case 2:n=e.sent,t=[],t=$(n[0]),l=[],c=[],i=0;case 8:if(!(i<t.length)){e.next=29;break}return e.next=11,(0,u.wv)(t[i]);case 11:d=e.sent,o=(0,r.Z)(d,4),x=o[0],h=o[1],p=o[2],m=o[3],j=$(x),console.log("info===: ",j),f={productName:j[0].replace(/^"(.*)"$/,"$1"),producerName:j[1].replace(/^"(.*)"$/,"$1"),productionDate:j[2].replace(/^"(.*)"$/,"$1"),location:j[3].replace(/^"(.*)"$/,"$1"),batchNumber:j[4].replace(/^"(.*)"$/,"$1"),ingredients:$(j[5])},b=JSON.parse(m),T=b.map((function(e){var n=(0,r.Z)(e,3),s=n[0],t=n[1],l=n[2];return{node:{nodeAddress:s[0],nodeType:s[1],isRegistered:s[2]},isVerified:t,timestamp:l}})),console.log("chainTracesTmp===: ",T),C=T.some((function(e){return e.node.nodeAddress===localStorage.getItem("address")})),console.log("isUserInChainTraces===: ",C),C&&(w={productInfo:f,productHash:t[i],owner:h,paused:p,chainTraces:T},T[T.length-1].node.nodeAddress!==localStorage.getItem("address")?c.push(0):T[T.length-1].node.nodeAddress!==localStorage.getItem("address")||T[T.length-1].isVerified?T[T.length-1].node.nodeAddress===localStorage.getItem("address")&&T[T.length-1].isVerified&&c.push(2):c.push(1),l.push(w));case 26:i++,e.next=8;break;case 29:s(l),g(c),console.log("productList===: ",l);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,c.useEffect)((function(){"0"===localStorage.getItem("nodeType")?(alert("\u60a8\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\u8be5\u9875\u9762\uff01"),window.location.href="/pages"):H()}),[]);var $=function(e){return e.replace(/\[(.*)\]/,"$1").split(",").map((function(e){return e.trim()}))},B=function(){var e=(0,t.Z)(a().mark((function e(n){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.kD)(localStorage.getItem("signUserId"),n);case 2:if(!(s=e.sent).statusOK){e.next=10;break}return alert("\u9a8c\u8bc1\u6210\u529f\uff01"),e.next=7,H();case 7:R(1),e.next=11;break;case 10:alert("\u9a8c\u8bc1\u5931\u8d25\uff01\u9519\u8bef\u4fe1\u606f\uff1a"+s.message);case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=(0,t.Z)(a().mark((function e(n){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.ap)(localStorage.getItem("signUserId"),[h,n]);case 2:if(!(s=e.sent).statusOK){e.next=10;break}return alert("\u6d41\u8f6c\u6210\u529f\uff01"),e.next=7,H();case 7:R(2),e.next=11;break;case 10:alert("\u6d41\u901a\u5931\u8d25\uff01\u9519\u8bef\u4fe1\u606f\uff1a"+s.message);case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,x.jsxs)(o.Z,{children:[(0,x.jsx)(d.Z,{children:"\u6d41\u901a\u7ba1\u7406"}),(0,x.jsxs)("div",{children:[(0,x.jsx)(i.TableContainer,{className:"mb-8",children:(0,x.jsxs)(i.Table,{children:[(0,x.jsx)(i.TableHeader,{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)(i.TableCell,{children:"\u4ea7\u54c1\u540d\u79f0"}),(0,x.jsx)(i.TableCell,{children:"\u751f\u4ea7\u5546\u540d\u79f0"}),(0,x.jsx)(i.TableCell,{children:"\u751f\u4ea7\u65e5\u671f"}),(0,x.jsx)(i.TableCell,{children:"\u4ea7\u5730"}),(0,x.jsx)(i.TableCell,{children:"\u6279\u6b21\u7f16\u53f7"}),(0,x.jsx)(i.TableCell,{children:"\u64cd\u4f5c"})]})}),(0,x.jsx)(i.TableBody,{children:n.map((function(e,n){return(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:(0,x.jsx)("div",{className:"flex items-center text-sm",children:e.productInfo.productName})}),(0,x.jsx)(i.TableCell,{children:(0,x.jsx)("div",{className:"flex items-center text-sm",children:e.productInfo.producerName})}),(0,x.jsx)(i.TableCell,{children:(0,x.jsx)("div",{className:"flex items-center text-sm",children:e.productInfo.productionDate})}),(0,x.jsx)(i.TableCell,{children:(0,x.jsx)("div",{className:"flex items-center text-sm",children:e.productInfo.location})}),(0,x.jsx)(i.TableCell,{children:(0,x.jsx)("div",{className:"flex items-center text-sm",children:e.productInfo.batchNumber})}),(0,x.jsx)(i.TableCell,{children:(0,x.jsxs)("div",{className:"flex items-center text-sm",children:[(0,x.jsx)(i.Button,{onClick:function(){return M(3,e)},children:" \u8be6\u60c5 "}),"\xa0\xa0",1==T[n]?(0,x.jsx)(i.Button,{onClick:function(){return M(1,e)},children:" \u9a8c\u8bc1 "}):2==T[n]?(0,x.jsx)(i.Button,{onClick:function(){return M(2,e)},children:" \u6d41\u8f6c "}):" "]})})]},n)}))})]})}),(0,x.jsxs)(i.Modal,{onClose:function(){return R(1)},isOpen:w,children:[(0,x.jsx)(i.ModalHeader,{children:"\u9a8c\u8bc1\u4ea7\u54c1"}),(0,x.jsxs)(i.ModalBody,{children:[(0,x.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,x.jsx)("span",{className:"w-20 text-sm",children:"\u4ea7\u54c1\u540d\u79f0\uff1a"}),j.productInfo.productName]}),(0,x.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,x.jsx)("span",{className:"w-20 text-sm",children:"\u4ea7\u54c1\u54c8\u5e0c\uff1a"}),j.productHash]})]}),(0,x.jsx)(i.ModalFooter,{children:(0,x.jsx)(i.Button,{onClick:function(){return B(j.productHash)},children:"\u9a8c\u8bc1"})})]}),(0,x.jsxs)(i.Modal,{onClose:function(){return R(2)},isOpen:I,children:[(0,x.jsx)(i.ModalHeader,{children:"\u6d41\u8f6c\u4ea7\u54c1"}),(0,x.jsxs)(i.ModalBody,{children:[(0,x.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,x.jsx)("span",{className:"w-20 text-sm",children:"\u4ea7\u54c1\u540d\u79f0\uff1a"}),j.productInfo.productName]}),(0,x.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,x.jsx)("span",{className:"w-20 text-sm",children:"\u4ea7\u54c1\u54c8\u5e0c\uff1a"}),j.productHash]}),(0,x.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,x.jsx)("span",{className:"w-20 text-sm",children:"\u6d41\u901a\u5546\u8282\u70b9\u5730\u5740\uff1a"}),(0,x.jsx)(i.Input,{name:"transferNewAddr",value:h,onChange:function(e){return p(e.target.value)}})]})]}),(0,x.jsx)(i.ModalFooter,{children:(0,x.jsx)(i.Button,{onClick:function(){return O(j.productHash)},children:"\u6d41\u8f6c"})})]}),(0,x.jsxs)(i.Modal,{onClose:function(){return R(3)},isOpen:y,children:[(0,x.jsx)(i.ModalHeader,{children:"\u4ea7\u54c1\u8be6\u60c5"}),(0,x.jsx)(i.ModalBody,{children:(0,x.jsx)(i.Table,{children:(0,x.jsxs)(i.TableBody,{children:[(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u4ea7\u54c1\u540d\u79f0"}),(0,x.jsx)(i.TableCell,{children:j.productInfo.productName})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u751f\u4ea7\u5546\u540d\u79f0"}),(0,x.jsx)(i.TableCell,{children:j.productInfo.producerName})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u751f\u4ea7\u65e5\u671f"}),(0,x.jsx)(i.TableCell,{children:j.productInfo.productionDate})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u4ea7\u5730"}),(0,x.jsx)(i.TableCell,{children:j.productInfo.location})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u6279\u6b21\u7f16\u53f7"}),(0,x.jsx)(i.TableCell,{children:j.productInfo.batchNumber})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u539f\u6599\u6e05\u5355"}),(0,x.jsx)(i.TableCell,{children:j.productInfo.ingredients})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u4ea7\u54c1\u54c8\u5e0c"}),(0,x.jsx)(i.TableCell,{children:j.productHash})]}),(0,x.jsxs)(i.TableRow,{children:[(0,x.jsx)(i.TableCell,{children:"\u4ea7\u54c1\u6d41\u901a\u8be6\u60c5"}),(0,x.jsx)(i.TableCell,{children:j.chainTraces.map((function(e,n){return(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{children:(0,x.jsx)("b",{children:0===n?"\u51fa\u5382":"\u7b2c "+n+" \u6b21\u6d41\u901a"})}),(0,x.jsxs)("div",{children:["\u8282\u70b9\u5730\u5740\uff1a",e.node.nodeAddress]}),(0,x.jsxs)("div",{children:["\u8282\u70b9\u7c7b\u578b\uff1a",0==e.node.nodeType?"\u751f\u4ea7\u5546":1===e.node.nodeType?"\u6d41\u901a\u5546":"Regulator"]}),(0,x.jsxs)("div",{children:["\u8282\u70b9\u72b6\u6001\uff1a",e.node.isRegistered?"\u5df2\u5ba1\u6838":"\u672a\u5ba1\u6838"]}),(0,x.jsxs)("div",{children:["\u6d41\u901a\u65f6\u95f4\uff1a","".concat(new Date(e.timestamp).getFullYear(),"-").concat(new Date(e.timestamp).getMonth()+1,"-").concat(new Date(e.timestamp).getDate()," ").concat(new Date(e.timestamp).getHours(),":").concat(new Date(e.timestamp).getMinutes(),":").concat(new Date(e.timestamp).getSeconds())]}),(0,x.jsxs)("div",{children:["\u6d41\u901a\u72b6\u6001\uff1a",e.isVerified?"\u5df2\u9a8c\u8bc1":"\u672a\u9a8c\u8bc1"]})]},n)}))})]})]})})})]})]})]})}},6222:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pages/distributors",function(){return s(6393)}])}},function(e){e.O(0,[442,196,316,774,888,179],(function(){return n=6222,e(e.s=n);var n}));var n=e.O();_N_E=n}]);